if(typeof KAJONA=="undefined"){var KAJONA={util:{},portal:{lang:{}},admin:{lang:{}}}}KAJONA.util.evalScript=function(a){try{if(a!=""){var b="";a=a.replace(/<script[^>]*>([\s\S]*?)<\/script>/gi,function(){if(a!==null){b+=arguments[1]+"\n"}return""});if(b){(window.execScript)?window.execScript(b):window.setTimeout(b,0)}}return false}catch(c){alert(c)}};KAJONA.util.isTouchDevice=function(){return !!("ontouchstart" in window)?1:0};KAJONA.util.inArray=function(c,b){for(var a=0;a<b.length;a++){if(b[a]==c){return true}}return false};KAJONA.util.fold=function(d,b,a){var c=document.getElementById(d);if(c.style.display=="none"){c.style.display="block";if($.isFunction(b)){b()}}else{c.style.display="none";if($.isFunction(a)){a()}}};KAJONA.util.foldImage=function(f,e,b,d){var a=document.getElementById(f);var c=document.getElementById(e);if(a.style.display=="none"){a.style.display="block";c.src=b}else{a.style.display="none";c.src=d}};KAJONA.util.setBrowserFocus=function(a){$(function(){try{focusElement=$("#"+a);if(focusElement.hasClass("inputWysiwyg")){CKEDITOR.config.startupFocus=true}else{focusElement.focus()}}catch(b){}})};KAJONA.util.mover=(function(){var f;var b;var h=null;var e=0;var d=0;function a(i){if(document.all){f=event.clientX+document.body.scrollLeft;b=event.clientY+document.body.scrollTop}else{f=i.pageX;b=i.pageY}if(h!=null){h.style.left=f-e+"px";h.style.top=b-d+"px"}}function g(i){h=i;e=f-h.offsetLeft;d=b-h.offsetTop}function c(){h=null}return{checkMousePosition:a,setMousePressed:g,unsetMousePressed:c}}());KAJONA.admin.loader=new KAJONA.util.Loader();KAJONA.admin.folderview={dialog:undefined,selectCallbackCKEditorFuncNum:0,selectCallback:function(a,b){if(window.opener){window.opener.KAJONA.admin.folderview.fillFormFields(a)}else{if(parent){parent.KAJONA.admin.folderview.fillFormFields(a)}}if($.isFunction(b)){b()}this.close()},fillFormFields:function(a){for(var c in a){if(a[c][0]=="ckeditor"){CKEDITOR.tools.callFunction(this.selectCallbackCKEditorFuncNum,a[c][1])}else{var d=$("#"+a[c][0]).get(0);if(d!=null){d.value=a[c][1];if(document.createEvent){var b=document.createEvent("Events");b.initEvent("change",true,true,window,0,0,0,0,0,false,false,false,false,0,null);d.dispatchEvent(b)}else{if(document.createEventObject){var b=document.createEventObject();d.fireEvent("onchange",b)}}}}}},close:function(){if(window.opener){window.close()}else{if(parent){var a=parent.KAJONA.admin.folderview;a.dialog.hide();a.dialog.setContentRaw("")}}}};KAJONA.admin.tooltip={initTooltip:function(){KAJONA.admin.loader.loadFile(["/core/module_system/admin/scripts/qtip2/jquery.qtip.min.js","/core/module_system/admin/scripts/qtip2/jquery.qtip.min.css"],function(){$('*[rel=tooltip][title!=""]').qtip({position:{viewport:$(window)},style:{classes:"qtip-youtube qtip-shadow"}});$('*[rel=tagtooltip][title!=""]').each(function(){$(this).qtip({position:{viewport:$(window)},style:{classes:"qtip-youtube qtip-shadow"},content:{text:$(this).attr("title")+"<div id='tags_"+$(this).data("systemid")+"' data-systemid='"+$(this).data("systemid")+"'></div>"},events:{render:function(b,a){KAJONA.admin.loader.loadFile("/core/module_tags/admin/scripts/tags.js",function(){KAJONA.admin.tags.loadTagTooltipContent($(a.elements.content).find("div").data("systemid"),"",$(a.elements.content).find("div").attr("id"))})}}})})})},addTooltip:function(b,a){KAJONA.admin.loader.loadFile(["/core/module_system/admin/scripts/qtip2/jquery.qtip.min.js","/core/module_system/admin/scripts/qtip2/jquery.qtip.min.css"],function(){if(a){$(b).qtip({position:{viewport:$(window)},style:{classes:"qtip-youtube qtip-shadow"},content:{text:a}})}else{$(b).qtip({position:{viewport:$(window)},style:{classes:"qtip-youtube qtip-shadow"}})}})},removeTooltip:function(a){$(a).qtip("hide")}};KAJONA.admin.switchLanguage=function(b){var a=window.location.href;a=a.replace(/(\?|&)language=([a-z]+)/,"");if(a.indexOf("?")==-1){window.location.replace(a+"?language="+b)}else{window.location.replace(a+"&language="+b)}};KAJONA.admin.checkRightMatrix=function(){if(document.getElementById("inherit").checked){for(var b=0;b<document.forms.rightsForm.elements.length;b++){var a=document.forms.rightsForm.elements[b];if(a.type=="checkbox"){if(a.id!="inherit"){a.disabled=true;a.checked=false;var c="inherit,"+a.id;if(document.getElementById(c)!=null){if(document.getElementById(c).value=="1"){a.checked=true}}}}}}else{for(b=0;b<document.forms.rightsForm.elements.length;b++){var a=document.forms.rightsForm.elements[b];if(a.type=="checkbox"){if(a.id!="inherit"){a.disabled=false}}}}};KAJONA.admin.statusDisplay={idOfMessageBox:"jsStatusBox",idOfContentBox:"jsStatusBoxContent",classOfMessageBox:"jsStatusBoxMessage",classOfErrorBox:"jsStatusBoxError",timeToFadeOutMessage:4000,timeToFadeOutError:10000,timeToFadeOut:null,displayXMLMessage:function(a){if(a.indexOf("<message>")!=-1&&KAJONA_DEBUG>0&&a.indexOf("<error>")==-1){var c=a.indexOf("<message>")+9;var b=a.substr(c,a.indexOf("</message>")-c);this.messageOK(b)}if(a.indexOf("<error>")!=-1){var c=a.indexOf("<error>")+7;var b=a.substr(c,a.indexOf("</error>")-c);this.messageError(b)}},messageOK:function(a){$("#"+this.idOfMessageBox).removeClass(this.classOfMessageBox).removeClass(this.classOfErrorBox).addClass(this.classOfMessageBox);this.timeToFadeOut=this.timeToFadeOutMessage;this.startFadeIn(a)},messageError:function(a){$("#"+this.idOfMessageBox).removeClass(this.classOfMessageBox).removeClass(this.classOfErrorBox).addClass(this.classOfErrorBox);this.timeToFadeOut=this.timeToFadeOutError;this.startFadeIn(a)},startFadeIn:function(f){var c=$("#"+this.idOfMessageBox);var b=$("#"+this.idOfContentBox);b.html(f);c.css("display","").css("opacity",0);var d=$(window).width();var a=c.width();var g=d/2-a/2;var e=$(window).scrollTop()-2;c.css("top",e);c.css("left",g);KAJONA.admin.statusDisplay.fadeIn()},fadeIn:function(){$("#"+this.idOfMessageBox).animate({opacity:0.8},1000,function(){window.setTimeout("KAJONA.admin.statusDisplay.startFadeOut()",this.timeToFadeOut)})},startFadeOut:function(){$("#"+this.idOfMessageBox).animate({top:-200},1000,function(){$("#"+this.idOfMessageBox).css("display","none")})}};KAJONA.admin.systemtask={executeTask:function(c,b,a){if(a==null||a==undefined){if(document.getElementById("taskParamForm")!=null){document.getElementById("taskParamForm").style.display="none"}jsDialog_0.setTitle(KAJONA_SYSTEMTASK_TITLE);jsDialog_0.setContentRaw(kajonaSystemtaskDialogContent);document.getElementById(jsDialog_0.containerId).style.width="550px";document.getElementById("systemtaskCancelButton").onclick=this.cancelExecution;jsDialog_0.init()}KAJONA.admin.ajax.genericAjaxCall("system","executeSystemTask","&task="+c+b,function(h,d,g){if(d=="success"){var j=h;if(j.indexOf("<error>")!=-1){KAJONA.admin.statusDisplay.displayXMLMessage(j)}else{if(j.indexOf("<statusinfo>")==-1){KAJONA.admin.statusDisplay.messageError("<b>Request failed!</b><br />"+j)}else{var i=j.indexOf("<statusinfo>")+12;var e=j.substr(i,j.indexOf("</statusinfo>")-i);var f="";if(j.indexOf("<reloadurl>")!=-1){i=j.indexOf("<reloadurl>")+11;f=j.substr(i,j.indexOf("</reloadurl>")-i)}document.getElementById("systemtaskStatusDiv").innerHTML=e;if(f==""){jsDialog_0.setTitle(KAJONA_SYSTEMTASK_TITLE_DONE);document.getElementById("systemtaskLoadingDiv").style.display="none";document.getElementById("systemtaskCancelButton").value=KAJONA_SYSTEMTASK_CLOSE}else{KAJONA.admin.systemtask.executeTask(c,f,true)}}}}else{jsDialog_0.hide();KAJONA.admin.statusDisplay.messageError("<b>Request failed!</b><br />"+h)}})},cancelExecution:function(){jsDialog_0.hide()},setName:function(a){document.getElementById("systemtaskNameDiv").innerHTML=a}};KAJONA.admin.ajax={getDataObjectFromString:function(d,a){var b=d.split("&");var c={};if(a){c.systemid=b[0]}if(b.length>1){$.each(b,function(e,g){if(!a||e>0){var f=g.split("=");c[f[0]]=f[1]}})}return c},regularCallback:function(c,a,b){if(a=="success"){KAJONA.admin.statusDisplay.displayXMLMessage(c)}else{KAJONA.admin.statusDisplay.messageError("<b>Request failed!</b>")}},genericAjaxCall:function(b,d,f,a){var e=KAJONA_WEBPATH+"/xml.php?admin=1&module="+b+"&action="+d;var c=this.getDataObjectFromString(f,true);$.ajax({type:"POST",url:e,data:c,success:a,dataType:"text"})},setAbsolutePosition:function(e,d,b,a,c){if(c==null||c==""){c="system"}if(typeof a=="undefined"||a==null){a=KAJONA.admin.ajax.regularCallback}KAJONA.admin.ajax.genericAjaxCall(c,"setAbsolutePosition",e+"&listPos="+d,a)},setSystemStatus:function(a,c){var b=function(j,f,i){if(f=="success"){KAJONA.admin.statusDisplay.displayXMLMessage(j);if(c!==null&&c===true){location.reload()}if(j.indexOf("<error>")==-1&&j.indexOf("<html>")==-1){var g=$($.parseXML(j)).find("newstatus").text();var h=$("#statusLink_"+a);var e=h.parents(".admintable > tbody").first();if(!e.length){e=h.parents(".grid > ul > li").first()}if(g==0){h.html(KAJONA.admin.ajax.setSystemStatusMessages.strInActiveIcon);e.addClass("disabled")}else{h.html(KAJONA.admin.ajax.setSystemStatusMessages.strActiveIcon);e.removeClass("disabled")}KAJONA.admin.tooltip.addTooltip(h.find("span"))}}else{KAJONA.admin.statusDisplay.messageError(j)}};var d=$("#statusLink_"+a);KAJONA.admin.tooltip.removeTooltip(d.find("span"));KAJONA.admin.ajax.genericAjaxCall("system","setStatus",a,b)},setSystemStatusMessages:{strInActiveIcon:"",strActiveIcon:""}};KAJONA.admin.forms={};KAJONA.admin.forms.renderMandatoryFields=function(a){for(var c=0;c<a.length;c++){var b=a[c];if(b.length==2){if(b[1]=="date"){$("#"+b[0]+"_day").addClass("mandatoryFormElement");$("#"+b[0]+"_month").addClass("mandatoryFormElement");$("#"+b[0]+"_year").addClass("mandatoryFormElement")}if($("#"+b[0])){$("#"+b[0]).addClass("mandatoryFormElement")}}}};KAJONA.admin.forms.renderMissingMandatoryFields=function(a){$(a).each(function(){if($("#"+this)){$("#"+this).closest(".control-group").addClass("error")}})};KAJONA.admin.lists={arrSystemids:[],strConfirm:"",strCurrentUrl:"",strCurrentTitle:"",strDialogTitle:"",strDialogStart:"",intTotal:0,toggleAllFields:function(){$("table.admintable input[type='checkbox']").each(function(){if($(this).attr("id").substr(0,6)=="kj_cb_"&&$(this).attr("id")!="kj_cb_batchActionSwitch"){$(this)[0].checked=$("#kj_cb_batchActionSwitch")[0].checked}})},updateToolbar:function(){if($("table.admintable  input:checked").length==0){$(".batchActionsWrapper").removeClass("visible")}else{$(".batchActionsWrapper").addClass("visible")}},triggerAction:function(a,c){KAJONA.admin.lists.arrSystemids=[];KAJONA.admin.lists.strCurrentUrl=c;KAJONA.admin.lists.strCurrentTitle=a;$("table.admintable  input:checked").each(function(){if($(this).attr("id").substr(0,6)=="kj_cb_"&&$(this).attr("id")!="kj_cb_batchActionSwitch"){var d=$(this).closest("tr").data("systemid");if(d!=""){KAJONA.admin.lists.arrSystemids.push(d)}}});if(KAJONA.admin.lists.arrSystemids.length==0){return}var b=KAJONA.admin.lists.strConfirm.replace("%amount%",KAJONA.admin.lists.arrSystemids.length);b=b.replace("%title%",a);jsDialog_1.setTitle(KAJONA.admin.lists.strDialogTitle);jsDialog_1.setContent(b,KAJONA.admin.lists.strDialogStart,"javascript:KAJONA.admin.lists.executeActions();");jsDialog_1.init();$("#"+jsDialog_1.containerId).on("hidden",function(){KAJONA.admin.lists.arrSystemids=[]});return false},executeActions:function(){console.log("starting execution");KAJONA.admin.lists.intTotal=KAJONA.admin.lists.arrSystemids.length;$(".batchActionsProgress > .progresstitle").text(KAJONA.admin.lists.strCurrentTitle);$(".batchActionsProgress > .total").text(KAJONA.admin.lists.intTotal);jsDialog_1.setContentRaw($(".batchActionsProgress").html());KAJONA.admin.lists.triggerSingleAction()},triggerSingleAction:function(){if(KAJONA.admin.lists.arrSystemids.length>0&&KAJONA.admin.lists.intTotal>0){$(".batch_progressed").text((KAJONA.admin.lists.intTotal-KAJONA.admin.lists.arrSystemids.length+1));$(".progress > .bar").css("width",((KAJONA.admin.lists.intTotal-KAJONA.admin.lists.arrSystemids.length)/KAJONA.admin.lists.intTotal*100)+"%");var a=KAJONA.admin.lists.strCurrentUrl.replace("%systemid%",KAJONA.admin.lists.arrSystemids[0]);KAJONA.admin.lists.arrSystemids.shift();$.ajax({type:"POST",url:a,success:function(){KAJONA.admin.lists.triggerSingleAction()},dataType:"text"})}else{$(".batch_progressed").text((KAJONA.admin.lists.intTotal));$(".progress > .bar").css("width",100+"%");document.location.reload()}}};KAJONA.admin.dashboardCalendar={};KAJONA.admin.dashboardCalendar.eventMouseOver=function(strSourceId){if(strSourceId==""){return}var sourceArray=eval("kj_cal_"+strSourceId);if(typeof sourceArray!=undefined){for(var i=0;i<sourceArray.length;i++){$("#event_"+sourceArray[i]).addClass("mouseOver")}}};KAJONA.admin.dashboardCalendar.eventMouseOut=function(strSourceId){if(strSourceId==""){return}var sourceArray=eval("kj_cal_"+strSourceId);if(typeof sourceArray!=undefined){for(var i=0;i<sourceArray.length;i++){$("#event_"+sourceArray[i]).removeClass("mouseOver")}}};KAJONA.admin.messaging={getUnreadCount:function(a){KAJONA.admin.ajax.genericAjaxCall("messaging","getUnreadMessagesCount","",function(e,b,d){if(b=="success"){var c=$($.parseXML(e));KAJONA.admin.messaging.intCount=c.find("messageCount").text();a(c.find("messageCount").text())}})},getRecentMessages:function(a){KAJONA.admin.ajax.genericAjaxCall("messaging","getRecentMessages","",function(e,b,d){if(b=="success"){var c=$.parseJSON(e);a(c)}})}};