if(typeof KAJONA=="undefined"){var KAJONA={util:{},portal:{lang:{}},admin:{lang:{}}}}KAJONA.admin.portaleditor={objPlaceholderWithElements:{},initPortaleditor:function(){CKEDITOR_BASEPATH=KAJONA_WEBPATH+"/core/module_system/admin/scripts/ckeditor/";KAJONA.admin.loader.loadFile(["/core/module_system/admin/scripts/ckeditor/ckeditor.js"],function(){CKEDITOR.dtd.$editable.span=1;CKEDITOR.dtd.$editable.a=1;CKEDITOR.dtd.$editable.label=1;CKEDITOR.dtd.$editable.td=1;CKEDITOR.disableAutoInline=true;KAJONA.admin.portaleditor.RTE.init()});KAJONA.admin.portaleditor.dragndrop.init()},switchEnabled:function(a){var b=a==true?"true":"false";var d=window.location.href;var c=d.indexOf("#");if(c!=-1){d=d.substring(0,c)}d=d.replace("&pe=false","");d=d.replace("&pe=true","");d=d.replace("?pe=false","");d=d.replace("?pe=true","");if(d.indexOf("?")==-1){window.location.replace(d+"?pe="+b)}else{window.location.replace(d+"&pe="+b)}},openDialog:function(a){peDialog.setContentIFrame(a);peDialog.init()},closeDialog:function(){var a=confirm(KAJONA.admin.lang.pe_dialog_close_warning);if(a){peDialog.hide();peDialog.setContentRaw("")}},addNewElements:function(c,b,a){this.objPlaceholderWithElements[c]={placeholderName:b,elements:a}}};KAJONA.admin.portaleditor.RTE={};KAJONA.admin.portaleditor.RTE.config={};KAJONA.admin.portaleditor.RTE.modifiedFields={};KAJONA.admin.portaleditor.RTE.savePage=function(){$.each(KAJONA.admin.portaleditor.RTE.modifiedFields,function(b,d){var a=b.split("#");var c={systemid:a[0],property:a[1],value:d};$.post(KAJONA_WEBPATH+"/xml.php?admin=1&module=pages_content&action=updateObjectProperty",c,function(){})});KAJONA.admin.portaleditor.RTE.modifiedFields={}};KAJONA.admin.portaleditor.RTE.init=function(){$("*[data-kajona-editable]").each(function(){var c=$(this);var b=c.attr("data-kajona-editable").split("#");var a=b[2]?b[2]:"wysiwyg";var d=KAJONA.admin.portaleditor.RTE.config;d.customConfig="config_kajona_standard.js";d.toolbar=a=="wysiwyg"?"pe_full":"pe_lite";d.forcePasteAsPlainText=true;d.kajona_strMode=a;d.on={blur:function(f){var g=f.editor.getData();var e=$(f.editor.element).attr("data-kajona-editable");KAJONA.admin.portaleditor.RTE.modifiedFields[e]=g;KAJONA.admin.portaleditor.RTE.savePage()},key:function(e){if(e.data.keyCode==13&&e.editor.config.kajona_strMode=="plain"){e.cancel()}}};c.bind("drop drag",function(){return false});c.attr("contenteditable","true");CKEDITOR.inline(c.get(0),d)});$(window).on("beforeunload",function(){var a=false;$.each(KAJONA.admin.portaleditor.RTE.modifiedFields,function(){a=true;return false});if(a){return KAJONA.admin.lang.pe_rte_unsavedChanges}})};KAJONA.admin.portaleditor.dragndrop={};KAJONA.admin.portaleditor.dragndrop.init=function(){var a=function(h,g){var e=h.item.data("element");var i=g.data("placeholder");if(i.substring(0,"master".length)=="master"&&h.item.parent(".pePlaceholderWrapper").data("placeholder").substring(0,"master".length)!="master"){return false}var f=i.split("_")[1].split("|");return f.indexOf(e)!==-1};var d=function(e,f){$.post(KAJONA_WEBPATH+"/xml.php?admin=1&module=system&action=setAbsolutePosition",{systemid:e,listPos:f+1})};var c;var b=false;$(".pePlaceholderWrapper").sortable({items:"div.peElementWrapper",handle:".moveHandle",connectWith:".pePlaceholderWrapper",cursor:"move",forcePlaceholderSize:true,placeholder:"peElementMovePlaceholder",start:function(e,f){c=f.item.parent().children("div.peElementWrapper").index(f.item)},activate:function(e,g){var f=$(this);if(a(g,f)){f.addClass("pePlaceholderWrapperDropTarget")}},over:function(e,g){var f=$(this);if(a(g,f)){$(g.placeholder).show()}else{$(g.placeholder).hide()}},receive:function(h,j){var i=$(this);var g=j.sender;if(a(j,i)){var k=i.data("placeholder");var e=j.item.data("systemid");var f=j.item.parent().children("div.peElementWrapper").index(j.item);b=true;$.post(KAJONA_WEBPATH+"/xml.php?admin=1&module=pages_content&action=moveElement",{systemid:e,placeholder:k},function(){d(e,f);b=false})}else{g.sortable("cancel")}},stop:function(g,h){if(!b){var f=h.item.parent().children("div.peElementWrapper").index(h.item);if(c!==f){var e=h.item.data("systemid");d(e,f)}}c=null},deactivate:function(e,g){var f=$(this);f.removeClass("pePlaceholderWrapperDropTarget")},delay:KAJONA.util.isTouchDevice()?2000:0})};KAJONA.admin.folderview={dialog:undefined,selectCallbackCKEditorFuncNum:0,selectCallback:function(a,b){if(window.opener){window.opener.KAJONA.admin.folderview.fillFormFields(a)}else{if(parent){parent.KAJONA.admin.folderview.fillFormFields(a)}}if($.isFunction(b)){b()}this.close()},fillFormFields:function(a){for(var c in a){if(a[c][0]=="ckeditor"){CKEDITOR.tools.callFunction(this.selectCallbackCKEditorFuncNum,a[c][1])}else{var d=$("#"+a[c][0]).get(0);if(d!=null){d.value=a[c][1];if(document.createEvent){var b=document.createEvent("Events");b.initEvent("change",true,true,window,0,0,0,0,0,false,false,false,false,0,null);d.dispatchEvent(b)}else{if(document.createEventObject){var b=document.createEventObject();d.fireEvent("onchange",b)}}}}}},close:function(){if(window.opener){window.close()}else{if(parent){var a=parent.KAJONA.admin.folderview;a.dialog.hide();a.dialog.setContentRaw("")}}}};KAJONA.admin.loader=new KAJONA.util.Loader();KAJONA.admin.tooltip={initTooltip:function(){KAJONA.admin.loader.loadFile(["/core/module_system/admin/scripts/qtip2/jquery.qtip.min.js","/core/module_system/admin/scripts/qtip2/jquery.qtip.min.css"],function(){$("*[rel=tooltip]").qtip({position:{viewport:$(window)},style:{classes:"qtip-youtube qtip-shadow"}})})},addTooltip:function(b,a){KAJONA.admin.loader.loadFile(["/core/module_system/admin/scripts/qtip2/jquery.qtip.min.js","/core/module_system/admin/scripts/qtip2/jquery.qtip.min.css"],function(){if(a){$(b).qtip({position:{viewport:$(window)},style:{classes:"qtip-youtube qtip-shadow"},content:{text:a}})}else{$(b).qtip({position:{viewport:$(window)},style:{classes:"qtip-youtube qtip-shadow"}})}})}};KAJONA.admin.tooltip.initTooltip();